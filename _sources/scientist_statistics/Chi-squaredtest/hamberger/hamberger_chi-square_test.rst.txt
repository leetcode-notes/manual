
hamberger 3.2　カイ２乗値とカイ２乗分布
==========================================

http://kogolab.chillout.jp/elearn/hamburger/

http://kogolab.chillout.jp/elearn/hamburger/chap3/sec2.html

仮説を立てる
--------------

統計学では、まず「仮説」を立てるところから出発します。仮説とは、「○○である」ということを仮に立てたものです。

そのあとで、それを肯定するか、あるいは否定するかを決めるのです。

ここでは、次の仮説を立ててみました。

「チキンとポテトの売り上げの割合に関して、モグモグとワクワクの間に差はない」

おや「……差はない」ですか。これはどういうことでしょうか。ふつうは、「差がある」ことを証明したいわけですから、「差はある」という仮説を立てるのが自然ではないでしょうか。

その通りです。しかし、統計学では、あえて「差はない」という仮説を最初に立てます。

これを「帰無仮説」と呼びます。
--------------------------------

なぜ帰無仮説を最初に立てるかというと、「差はある」という仮説は、「大きな差がある」、「小さな差がある」、「中位の差がある」などなど、

無限に立てられるからです。

そのひとつひとつについて検討するのは事実上不可能です。それに対して、帰無仮説「差はない」というのは、これ以外の形はありません。

ですから、これを肯定するか、否定するかを決めればいいことになり、単純になります。

仮説を肯定することを「採択する」、否定することを「棄却する」といいます。

もし帰無仮説が採択されれば、「差はない」と結論します。

反対に、もし帰無仮説が棄却された場合は、「差はない、とは言えない」つまり「差はある」と結論されることになります。

帰無仮説の反対の仮説のことを、

「対立仮説」と呼びます。

対立仮説は、帰無仮説が棄却されたときに採択される仮説で、「差はないとは言えない、つまり差はある」という形です。

まとめると、次のような流れになります。

+ まず、帰無仮説「差はない」を立てる

+ 次に、帰無仮説を採択するか、棄却するかを決める

+ 帰無仮説を採択した場合は、「差はない」と結論する

+ 帰無仮説を棄却した場合は、対立仮説を採択し、「差はないとはいえない、つまり差はある」と結論する


仮説を検討してみよう
----------------------

帰無仮説として「売り上げの割合に差はない」という仮説を立てます。

ワクワクもモグモグも、ポテトとチキンがまったく同じ割合で売れるとしたときの、売り上げ個数をだしてみましょう。

そこで、帰無仮説による個数と実際の個数がそれほど変わらなければ、帰無仮説を採択し、差はないと結論することになります。

ポテトとチキンが同じ割合で売れるとしたときの個数の出し方

両店で、ポテトとチキンが同じ割合で売れるとしたときの個数を計算します。

それぞれのお店の売り上げ個数と、ポテトとチキンの売り上げ個数を使えば、その個数を求めることができます。

表3.2　同じ割合で売れるとしたときの、ポテトとチキンの売り上げ数を逆算する(1)

お店	ポテト	チキン	合計

ワクワク	?	?	600

モグモグ	?	?	400

合計	700	300	1000

上の表のように合計個数だけをみると、全体の売り上げに対して、それぞれのお店の合計個数の割合は、

ワクワクで、600÷1000

モグモグで、400÷1000　　になります。

それに対して、ポテトとチキンの割合は700対300です。

ですから、同じ割合で売れるとしたら、

ワクワクのポテトは、600÷1000×700＝420

モグモグのポテトは、400÷1000×700＝280　　になります。

それでは、チキンの個数はどれくらいになるでしょうか。計算して、下の表を埋めてください。

表3.3　同じ割合で売れるとしたときの、ポテトとチキンの売り上げ数を逆算する(2)

お店	ポテト	チキン	合計

ワクワク	420	　	600

モグモグ	280	　	400

合計	700	300	1000

どうなりましたか。私の計算では、

ワクワクのチキンは、600÷1000×300＝180

モグモグのチキンは、400÷1000×300＝120　　になりました。　
　　
結局、同じ割合で売れるとしたときの売り上げ個数の表は下のようになります。

表3.4　同じ割合で売れるとしたときの、ポテトとチキンの売り上げ数

お店	ポテト	チキン	合計

ワクワク	420	180	600

モグモグ	280	120	400

合計	700	300	1000

この個数を「期待度数」と呼びます。

これは、帰無仮説、つまり「両店のポテトとチキンの売り上げ割合に差がない」が成立したときに、期待される度数ということです。

しかし、実際の売り上げ個数はこのようになっていました。

表3.5　実際のポテトとチキンの売り上げ数

お店	ポテト	チキン	合計

ワクワク	435	165	600

モグモグ	265	135	400

合計	700	300	1000

この個数を「観測度数」と呼びます。

つまり、実際に観測された度数ということです。


観測度数と期待度数を比べてみる
-------------------------------

観測度数と期待度数とを比較してみると、次のことが言えます。

ワクワクでは、

ポテトは実際の方が多い（観測度数435に対して期待度数420）。

チキンは実際の方が少ない（観測度数165に対して期待度数180）。

モグモグでは、

ポテトは実際の方が少ない（観測度数265に対して期待度数280）。

チキンは実際の方が多い（観測135に対して期待度数120）。

さて、このように期待度数と観測度数には違いがあることがわかりました。

しかし、はたしてこの違いには「意味があるのでしょうか」？　

たとえば、ワクワクのポテトの個数は、観測度数435に対して、期待度数は420でした。

この435と420との差「15」には意味があるのかどうか？

「意味があるのかどうか」ということは、こういうことです。

たとえば、460と420というデータがあって、この２つのずれは、本来同じだったのにたまたまずれてしまったものなのか、

あるいは、本来違っているものが現れてきたものなのか、このどちらなのかを決めるということです。

さらに言い換えれば、このずれは「誤差の範囲内のもの」なのか、それとも「誤差とは言えない、誤差以上のもの」なのか、を決めるということです。

これを決めるためには、検定という考え方を知る必要があります。


観測度数と期待度数のずれを数値にする
平均からのばらつきを数値にするために、分散という考え方を使いました。それと同じように、観測度数と期待度数のずれを数値にすることはできないのでしょうか。それを考えていきましょう。

まず、観測度数と期待度数のずれですから、それらをすべて足してみます。

ずれ案1＝（観測度数－期待度数）の総和

しかし、これで実際に計算してみると、

(435-420)+(165-180)+(265-280)+(135-120)
=15+(-15)+(-15)+15
=0

となり、常に0になってしまいます。プラスのところとマイナスのところが打ち消し合っているからです。

そこで、分散の計算の時のように２乗してから足していきます。

ずれ案2＝（（観測度数－期待度数）の２乗）の総和

(435-420)^2+(165-180)^2+(265-280)^2+(135-120)^2
=15^2+(-15)^2+(-15)^2+15^2
=900

となり、よさそうです。

しかし、これでもまだまずいところがあります。たとえば、ポテトとチキンの売り上げデータを10日分とったとします。単純に考えて、データが１日分の10倍となったとすると、ずれの値は、

(4350-4200)^2+(1650-1800)^2+(2650-2800)^2+(1350-1200)^2
=150^2+(-150)^2+(-150)^2+150^2
=90000

となって、非常に大きくなってしまいます。

そこで、（観測度数－期待度数）の２乗を期待度数で割っておくことにします。

ずれ案3＝（（（観測度数－期待度数）の２乗）÷期待度数）の総和

(435-420)^2/420+(165-180)^2/180+(265-280)^2/280+(135-120)^2/120
=15^2/420+(-15)^2/180+(-15)^2/280+15^2/120
=0.536+1.250+0.804+1.875
=4.464

これをカイ２乗値と呼びます。カイというのは、ギリシャ文字で「χ」と書きます。

もう一度まとめておきます。

カイ２乗値＝（（（観測度数－期待度数）の２乗）÷期待度数）の総和

この式からわかることは、
---------------------------

期待度数と観測度数が完全に一致すれば、カイ２乗値はゼロになる
逆に、不一致（ずれ）が大きくなれば、カイ２乗値は大きな値になる
ということです。

カイ２乗分布
--------------

さて、計算した結果、カイ２乗値は4.464になりました。

これはゼロではありませんから、観測度数と期待度数にずれがあることを示しています。

それでは、このカイ２乗値は大きいのでしょうか、それともとるにたらないものなのでしょうか？

これを決めるためには、カイ２乗値の性質、つまりカイ２乗分布を調べておく必要があります。

ピンポン玉実験
-------------------

白とオレンジのピンポン玉をそれぞれ50個ずつ箱に入れておきます。

よくかき混ぜて、無作為に10個取り出します。

そのときの、白の数とオレンジの数を調べます。

調べたら、また取り出した分を箱の中に戻して、また同じように無作為に10個取り出します。


このような実験を何回も繰り返すとどうなるでしょうか。

白とオレンジがそれぞれ5個ずつである場合は、比較的起こりやすそうです。もともと箱の中には半々ではいっていたのですから。

このときのカイ２乗値は（期待度数は5個と5個ですから）、

カイ２乗値＝(5-5)^2/5+(5-5)^2/5=0

このようにゼロになります。

それでは、白とオレンジが、6個と4個になる場合はあるでしょうか。

これも、よく起こりそうです。このときのカイ２乗値は、

カイ２乗値＝(6-5)^2/5+(4-5)^2/5=0.4

0.4になります。

それでは、白とオレンジが、7個と3個になる場合はどうでしょう。

6個と4個よりは起こりにくそうです。

カイ２乗値＝(7-5)^2/5+(3-5)^2/5=1.6

1.6になりました。

さらに、白とオレンジが、8個と2個の場合はどうでしょうか。

これはあまり起こらない場合です。

カイ２乗値＝(8-5)^2/5+(2-5)^2/5=3.6

カイ２乗値は3.6になります。

最後に、白とオレンジが、9個と1個の場合はどうでしょう。

これはめったに起こらない場合です。

カイ２乗値＝(9-5)^2/5+(1-5)^2/5=6.4

カイ２乗値は6.4になりました。

以上のことを表にまとめると、次のようになります。

表3.6　起こりやすさとカイ２乗値

白とオレンジの個数	起こりやすさ（確率）	カイ２乗値

5個と5個

最も起こりやすい

0

6個と4個

起こりやすい

0.4

7個と3個

起こりにくい

1.6

8個と2個

かなり起こりにくい

3.6

9個と1個

非常に起こりにくい

6.4

起こりやすさ（確率）が小さくなればなるほど、カイ２乗値が大きくなっていることがわかります。

カイ２乗分布


横軸にカイ２乗値を取り、縦軸に確率密度を取ると、次のようなカイ２乗分布が描けます。

確率密度というのは、たとえば横軸3のところで切った右側の面積が「カイ２乗値が3以上になる確率」になるように決めたものです。



これを見ると、カイ２乗値がゼロに近づくほど、急激に確率が大きくなっていくことかわかります。

逆にカイ２乗値が大きくなると、確率は非常に小さくなることがわかります。

この例では、白とオレンジのピンポン玉が50個と50個で半々になっていましたが、

これがたとえば60個と40個であっても、カイ２乗値を計算して分布を描くと、同じカイ２乗分布になります。

また、この例では、取り出す個数は10個でしたが、これが20個でも、30個でも、

カイ２乗値を計算して分布を描くと、同じカイ２乗分布になります。

このことから、カイ２乗分布がさまざまな場合に適用できることがわかります。

自由度によってカイ２乗分布は変わる

白とオレンジのピンポン玉を10個取ってくる場合は、白の数が決まれば、オレンジの数は自動的に決まります。つ

まり2種類の数のうち、自由に動かせるのは、そのうちひとつだけです。この数を「自由度」と呼びます。2種類のピンポン玉を取ってくる場合は、2－1で「自由度1」となります。

それでは、白とオレンジと青の3種類のピンポン玉ではどうでしょうか。この場合は、白とオレンジの数が決まると自動的に青の数が決まります。したがって、自由度は、3－1で2となります。

取り出す元の個数の割合が変わっても、また取り出す個数が変わっても、カイ２乗分布は変わりません。しかし、自由度が変わると、カイ２乗分布は変わります。図3.2のカイ２乗分布は、自由度1の場合の分布です。

自由度が変わると、次の図のようにカイ２乗分布も変わっていきます。

.. figure:: 0000.png
   :width: 400px


それでは、このカイ２乗分布を使って、ポテトとチキンの売り上げの割合に違いがあるかどうかを考えていきましょう。


カイ２乗値
-------------


カイ２乗値と自由度を求める
さて、ポテトとチキンの売り上げに戻りましょう。

表3.7　ポテトとチキンの売り上げ数（観測度数／期待度数）
お店	ポテト	チキン	合計
ワクワク	435/420	165/180	600
モグモグ	265/280	135/120	400
合計	700	300	1000
このカイ２乗値は、

（（（観測度数－期待度数）の２乗）÷期待度数）の総和

(435-420)^2/420+(165-180)^2/180+(265-280)^2/280+(135-120)^2/120
=15^2/420+(-15)^2/180+(-15)^2/280+15^2/120
=0.536+1.250+0.804+1.875
=4.46　（小数点第3位を四捨五入）

となりました。

Excelで計算する場合の式については、次のファイルをダウンロードして、参考にしてください。

★以上の計算をExcelで行った例をダウンロード★

この値はカイ２乗分布にしたがっているわけですが、自由度はいくつになるのでしょうか。

この場合は、

「ポテトとチキン」の2種類から1を引いて、1
「ワクワクとモグモグ」の2種類から1を引いて、1
これらをかけ算して、1×1＝1。自由度は1になります。

この意味は、「ワクワクのポテトが決まると、ワクワクのチキンが決まり（合計が決まっているから）、同時に、モグモグのポテトが決まり（合計が決まっているから）、さらにそれによって、モグモグのチキンも決まる。ということは、1つの値が決まれば、残りは自動的にきまる。つまり自由度は1である」ということです。

一般的に、行と列がある二次元の表の場合は、

自由度＝（行の数－1）×（列の数－1）

となります。

確率を求める
さて、自由度は1、カイ２乗値は4.46となりました。この値は大きいのでしょうか、小さいのでしょうか。言い換えれば、確率的に起こりにくいことなのでしょうか、起こりやすいことなのでしょうか。

自由度とカイ２乗値がわかったときに、それが起こる確率を調べる必要があります。そのときに、カイ２乗分布表を使うと便利です。

表3.8　カイ２乗分布表
↓自由度／確率→	0.05	0.01
1	3.84	6.63
2	5.99	9.21
3	7.81	11.34
4	9.49	13.28
5	11.07	15.09
…以下続く…	…	…
いま、自由度1のカイ２乗分布を考えると、次のようなグラフになります。



カイ２乗値が3.84のところでグラフを区切ると、それよりも左側で0.95(95%)、それよりも右側で0.05(5%)の面積になります。つまり、カイ２乗値が3.84よりも小さい値は、95%の確率で起こります。また、カイ２乗値が3.84よりも大きい値は、5%の確率でしか起こらないということになります。

つまり「ワクワクとモグモグではポテトとチキンの売り上げの割合には差がない（帰無仮説）」としたときに、そのカイ２乗値が3.84よりも大きくなる確率は5%よりも小さいということです。

さらにカイ２乗値が6.63よりも大きくなる確率は、1%よりも小さくなります。
　
さて、計算したカイ２乗値は4.46でした。これは次のように解釈できます。「ワクワクとモグモグのお店によってポテトとチキンの売り上げの割合には差がない（帰無仮説）」としたときに、そのカイ２乗値が4.46をとる確率は、5%よりも小さく、1%よりも大きい。

有意水準
-----------


カイ２乗値4.46がでてくる確率は、1%から5%の間だということがわかりました。これは、100回やって1回から5回しか起こらないということです。これは「起こりにくい」とするべきでしょうか。それとも「それほど起こりにくいことではない」とするべきなのでしょうか。確かに宝くじの一等が当たる確率よりは、大きいのですが。

めったに起こらないか、そうではないか、を決めるのに、統計学では「有意水準」というものを使います。有意水準よりも小さい確率であれば、それは「めったに起こらないこと」、つまり、偶然の誤差ではないと認定します。有意水準よりも大きい確率であれば、「めったに起こらないこととはいえない」、つまり、偶然の誤差であるとします。

有意水準は伝統的に、5%か、あるいは1%を使います。有意水準5％よりも、有意水準1%の方が厳しい判断の仕方といえます。5%、1%どちらを有意水準として使ってもかまいません。重要なのは、あらかじめ有意水準を決めておくということです。

仮説検定をする
さて、話をチキンとポテトに戻しましょう。

カイ２乗値は4.46でした。これは、5%から1%の確率で起こることです。

ここで、有意水準として5%をとるとすると、それよりも小さい確率ですので、「めったに起こらないこと」と認定できます。これは次のように解釈できます。

帰無仮説として「ワクワクとモグモグではポテトとチキンの売り上げの割合には差がない」としました。
カイ２乗値は4.46となり、これが起こるのは5%より小さい確率です。
有意水準を5%に設定したので、これは「めったに起こらないこと」であるといえます。
「めったに起こらないこと」が起こってしまったのは、帰無仮説が間違っていたからだと考えます。
したがって、帰無仮説「ワクワクとモグモグではポテトとチキンの売り上げの割合には差がない」は間違っていたと考えます。
帰無仮説を棄却します。
帰無仮説が棄却されたので、対立仮説「ワクワクとモグモグではポテトとチキン売り上げの割合に差がある」を採択します。これが結論になります。
カイ２乗検定の結果「ワクワクとモグモグではポテトとチキン売り上げの割合に差がある」という結論が得られました。

店員さんに結論を知らせる
あなたはこの結論を店員さんに知らせました。

「ポテトとチキンの売り上げについてカイ２乗検定をしたんですよ」

「な、なんだい、そのカイなんとかというのは？」

「ともかく、その結果、ワクワクとモグモグではポテトとチキン売り上げの割合に差がある、ということなんです。ワクワクの方がチキンの売り上げの割合が小さいんです。それは有意水準5%でいえることなんです」

「そのユウイなんとかってのは？」

「ともかく、差があるんですよ！」



「そ、そうか、売れ行きに違いがでたか。やっぱりうちのチキンは売れてないんだ」

「そういうことです」

「ふう、何か対策を考えなくちゃいけないな。うん、調べてくれてどうもありがとう」

仮説検定のまとめ
---------------------


さてあなたは、今回仮説をたてて、それが正しいかどうかを見てきました。ここで仮説検定のステップを確認しておきましょう。

1.　「○○と○○との間には差がない」という形の帰無仮説を立てる

2.　期待度数と観測度数のずれを見るためカイ２乗値を計算する

3.　カイ２乗値の出現確率を調べる

4.　有意水準を基準にして帰無仮説を棄却するか、あるいは採択するかを決める

この仮説検定の方法は、このあとも使っていきます。


ハンバーガーを入れてカイ２乗検定をする
-------------------------------------------


ポテトとチキンの売り上げの表を見ていて、あなたはひとつ気がつきました。

「よく考えたら、ハンバーガーショップで一番メインの商品であるハンバーガーの売り上げを入れてなかったなあ。よし、ハンバーガーの売り上げ数を調べてみよう」

さっそく、ハンバーガーの売り上げデータを調べてきました。ポテトとチキンの売り上げに加えて、ハンバーガーの売り上げデータを入れて、次のような表を作りました。

表3.9　ポテトとチキンとハンバーガーの売り上げ数
お店	ポテト	チキン	ハンバーガー	合計
ワクワク	435	165	650	1250
モグモグ	265	135	350	750
合計	700	300	1000	2000
帰無仮説と対立仮説を立てる
まず、帰無仮説を立てます。

帰無仮説：

次に、その逆である対立仮説を立てます。

対立仮説：

有意水準を決める
ここでは、有意水準をちょっと厳しくして、1%としましょう。

期待度数を計算する
観測度数の合計値を元にして、期待度数を計算します。

下の表を埋めましょう。

表3.10　ポテトとチキンとハンバーガーの売り上げの期待度数
お店	ポテト	チキン	ハンバーガー	合計
ワクワク	　	　	　	1250
モグモグ	　	　	　	750
合計	700	300	1000	2000
カイ２乗値を計算する
観測度数と期待度数を元にして、カイ２乗値を計算します。

カイ２乗値＝（（（観測度数－期待度数）の２乗）÷期待度数）の総和

（全部で6個のマスについて計算します）


（小数点第3位を四捨五入）

となります。

自由度を求める
自由度は、次のように求まります。

自由度＝（行の数－1）×（列の数－1）

したがって、

この場合の自由度は：

カイ２乗分布表を調べる
カイ２乗値と自由度が求まりましたので、カイ２乗分布表を調べます。

有意水準は1%ですので、0.01の列の自由度（　　）のマスを見ます。

そのときのカイ２乗値は：

表3.8　カイ２乗分布表
↓自由度／確率→	0.05	0.01
1	3.84	6.63
2	5.99	9.21
3	7.81	11.34
4	9.49	13.28
5	11.07	15.09
…以下続く…	…	…
計算したカイ２乗値と表の値を比べる
計算したカイ２乗値（　　　　）と表の値（　　　　）を比べます。

計算したカイ２乗値が……

もし表の値よりも大きければ、それは、1%よりも小さい確率でしか起こらないことが起こったということです。したがって帰無仮説が間違っていたと考え、帰無仮説を棄却します。

もし表の値よりも小さければ、それは、1%よりも大きい確率で起こりうることだということです。したがって帰無仮説を採択します。

結論を述べる
帰無仮説が棄却されたか、あるいは採択されたかということによって、結論を述べます。

結論は：

いかがでしたでしょうか。

うまくいきましたか。

Excelで計算した結果については、次のファイルをダウンロードして確認してください。